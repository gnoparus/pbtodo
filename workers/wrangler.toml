name = "pbtodo-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Development environment
[env.development]
name = "pbtodo-api-dev"
vars = { ENVIRONMENT = "development" }

# Production environment
[env.production]
name = "pbtodo-api"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "pbtodo-db"
database_id = "e3a9f258-138e-4270-84c9-d0d720594105"

# D1 Database binding for production
[[env.production.d1_databases]]
binding = "DB"
database_name = "pbtodo-db"
database_id = "e3a9f258-138e-4270-84c9-d0d720594105"

# KV namespace for sessions
[[kv_namespaces]]
binding = "SESSIONS"
id = "be366149c15e4007be460e67e8ab538f"
preview_id = "c210c38528164e50a58af2a05fb0b802"

# KV namespace for rate limiting
[[kv_namespaces]]
binding = "RATE_LIMITS"
id = "f115bf7d6b584fc7aee5ef4df507c1a9"
preview_id = "bd1e8e65b7ad417c8102dccce54cc1ff"

# Production KV namespaces
[[env.production.kv_namespaces]]
binding = "SESSIONS"
id = "be366149c15e4007be460e67e8ab538f"

[[env.production.kv_namespaces]]
binding = "RATE_LIMITS"
id = "f115bf7d6b584fc7aee5ef4df507c1a9"

# R2 bucket for assets (optional)
# [[r2_buckets]]
# binding = "ASSETS"
# bucket_name = "pbtodo-assets"
# preview_bucket_name = "pbtodo-assets-preview"

# Secrets (set via: wrangler secret put <NAME>)
# - JWT_SECRET: Secret key for JWT token signing
# - ENCRYPTION_KEY: Key for encrypting sensitive data

# Production routes (configure after domain setup)
# [[env.production.routes]]
# pattern = "api.yourdomain.com/*"
# zone_name = "yourdomain.com"

# CORS origins (configure as needed)
[vars]
ALLOWED_ORIGINS = "http://localhost:5173,http://127.0.0.1:5173,https://pbtodo.pages.dev"
ENVIRONMENT = "development"

[env.production.vars]
ALLOWED_ORIGINS = "https://pbtodo.pages.dev,https://yourdomain.com"
ENVIRONMENT = "production"
